---
title: 'ç”¨ Mitosis åŒæ—¶æ„å»º React å’Œ Vue ç»„ä»¶'
date: '2024-08-09'
cover: ''
tag: ['frontend', 'React', 'Vue']
---

ä¸Šæ¬¡å†™äº†ä¸ª[UnoCSS icon é€‰æ‹©å™¨](/zh-cn/blog/unocss-icon-viewer), å¸Œæœ›å†™ä¸ªåº“å¯ä»¥åŒæ—¶åœ¨ React å’Œ Vue ä¸­ä½¿ç”¨.  

é¦–å…ˆæƒ³åˆ°çš„æ˜¯ Web Component. ä½†ç¼ºç‚¹æ˜¯åœ¨æ ¸å¿ƒé€»è¾‘ä¹‹å¤–éœ€è¦é’ˆå¯¹ Vue å’Œ React åˆ†åˆ«ç¼–å†™ä¸€å¥—é€‚é…ä»£ç .  
å¯¹äºä¸€äº›æ¯”è¾ƒå°çš„éœ€æ±‚, å†™é€‚é…ä»£ç çš„æˆæœ¬å¯èƒ½æ¯”äººå·¥é€‚é…è¿˜è¦é«˜.  

ç„¶åæˆ‘å°±å‘ç°äº†`Mitosis`è¿™é‚ªé—¨ä¸œè¥¿.  
Mitosis çš„ä¸­æ–‡æ˜¯`æœ‰ä¸åˆ†è£‚`, é¡¾åæ€ä¹‰, å®ƒå¯ä»¥å°†ç»„ä»¶ç¼–è¯‘æˆå¤šä¸ªæ¡†æ¶çš„ä»£ç , åŒ…æ‹¬ React, Vue, Qwik, Solid, Angular, Svelte.  

å®ç°åŸç†å°±æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨, å°† Mitosis çš„æ–‡ä»¶ç¼–è¯‘æˆ Vue å’Œ React çš„æœ‰é™å­é›†. å’Œ UnoCSS ä¸€æ ·æ˜¯ä¸ªå‰ç«¯ç¼–è¯‘æœŸçš„æ¢ç´¢.

## åˆ›å»ºé¡¹ç›®
```bash
npm create @builder.io/mitosis@latest
```
è¾“å…¥å‘½ä»¤ä¼šæœ‰ä¸€äº›å¯é…ç½®çš„é€‰é¡¹, åœ¨é€‰æ‹©è¾“å‡ºç›®æ ‡æ—¶, åªæœ‰React, Svelte, Qwik. ä½†æ”¯æŒçš„æ¡†æ¶è¿œä¸æ­¢äºæ­¤.  
ä¿®æ”¹`library/mitosis.config.cjs`çš„`targets`å­—æ®µ, å¢åŠ  Vue æ”¯æŒ:  
```js
"targets": [
  "react",
  "vue",
],
```
é¡¹ç›®è‡ªå¸¦`todo-app.lite.tsx`å’Œ`autocomplete.lite.tsx`ä¸¤ä¸ªä¾‹å­, è¯•è¿è¡Œä¸€ä¸‹.  
```bash
cd library
npm run build

# Mitosis: react: generated 2 components, 1 regular files.
# Mitosis: vue: generated 2 components, 1 regular files.
# Mitosis: generation completed.
```
åœ¨`/library/package`ä¼šç”Ÿæˆ React å’Œ Vue çš„ç»„ä»¶.

## ç¼–å†™ç»„ä»¶  
Mitosis çš„ç»„ä»¶åç¼€æ˜¯`.lite.tsx`, å’Œ React è¿‘ä¼¼çš„ jsx è¯­æ³•, ä½†æœ‰ä¸€å¥—è‡ªå·±çš„ API å’Œé™åˆ¶.  
```tsx
import { useState } from "@builder.io/mitosis";

export default function MyComponent(props) {
  const [name, setName] = useState("Steve");

  return (
    <div>
      <input
        css={{
          color: "red",
        }}
        value={name}
        onChange={(event) => setName(event.target.value)}
      />
      Hello! I can run natively in React, Vue, Svelte, Qwik, and many more frameworks!
    </div>
  );
}
```
ä¾‹å¦‚ç”±äºç¼–è¯‘å™¨é™åˆ¶, ç»„ä»¶åªæ”¯æŒä¸Šé¢è¿™ç§ `export default function` çš„å†™æ³•, ä¸èƒ½ç”¨ const å®šä¹‰ç®­å¤´å‡½æ•°å†å¯¼å‡º.  

### çŠ¶æ€ç®¡ç†
ç°ä»£å‰ç«¯æ¡†æ¶æœ€é‡è¦çš„å°±æ˜¯`state`.  

#### useStore
mitosisç»„ä»¶çŠ¶æ€ç»´æŠ¤é€šè¿‡`useStore`é’©å­, è¿”å›å€¼æ¥æ”¶å¿…é¡»å«`state`(ä¹Ÿæ˜¯ç¼–è¯‘å™¨é™åˆ¶).   
```tsx
export default function MyComponent() {
  // ...
  const state = useStore({
    iconList: [],
  })
}
```
React ç»„ä»¶ä¸­, useStore ä¼šè¢«è½¬æ¢æˆä¸€ä¸ªç®€å•çš„`useState`å®šä¹‰.  

store çš„å‚æ•°å¡å•¥éƒ½å¯ä»¥, ä½†å¦‚æœä½ æƒ³è¦çš„å€¼éœ€è¦ç»è¿‡è¡¨è¾¾å¼è®¡ç®—å¾—åˆ°, å°±å¾—å†™ä¸ª`getter`:  
```tsx
const state = useStore({
  iconList: [],
  get outlineIcon() {
    return this.iconList.filter(icon => icon.endsWith('-outline'))
  },
})
```
`getter`ä¼šè½¬æ¢æˆä¸€ä¸ªç‹¬ç«‹çš„æ–¹æ³•:  
```tsx
const [iconList, setIconList] = useState(() => []);

function outlineIcon() {
  return iconList.filter((icon) => icon.endsWith("-outline"));
}
```

#### useState
mitosis ä¹Ÿæ”¯æŒuseState api, ä½¿ç”¨æ–¹å¼å’Œ React ä¸€æ ·:  
```tsx
const [count, setCount] = useState(0)
```
åœ¨ Vue ä¸­, useState å’Œ useStore éƒ½ä¼šè¢«ç¼–è¯‘æˆ options api ä¸­çš„`data`é€‰é¡¹.  

> é¡ºå¸¦ä¸€æ, ç°åœ¨ mitosis è¿˜ä¸æ”¯æŒ Vue 3 çš„`setup`å†™æ³•  

```ts
export default defineComponent({
  data() {
    return { count: 0 };
  },
})
```

### æ ·å¼
Mitosis é€šè¿‡æ ‡ç­¾ä¸Šçš„`css`å±æ€§æ¥ç¼–å†™`camelCase`çš„æ ·å¼, ä½ ç”šè‡³å¯ä»¥åƒè¿™æ ·å†™ css query.  
```tsx
<div
  css={{
    marginTop: '10px',
    '@media (max-width: 500px)': {
      marginTop: '0px',
    },
  }}
/>
```
è€Œä¸”ç¼–è¯‘åçš„ç»“æœè¿˜åšäº†æ ·å¼éš”ç¦». (React æœ¬ä½“åˆ°ç°åœ¨ä¹Ÿæ²¡æ”¯æŒğŸ˜‚)

å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨`class`å±æ€§(ä¸éœ€è¦ React ä¸­çš„ className), ä¸è¿‡è¿™æ ·å°±æ²¡æ³•åšæ ·å¼éš”ç¦»äº†.

## æµç¨‹æ§åˆ¶
ä¸ºäº†å±è”½ä¸åŒæ¡†æ¶çš„å·®å¼‚, Mitosis é€šè¿‡ä¸€æ ‡ç­¾å®ç°äº†è‡ªå·±çš„æµç¨‹æ§åˆ¶, ä»¥ä¸‹æ˜¯å¯¹ç…§è¡¨, è¯¦ç»†å¯ä»¥çœ‹[æ–‡æ¡£](https://mitosis.builder.io/docs/components/)  
| Mitosis | React | Vue |
| --- | --- | --- |
| `<Show>` | `if` | `v-if` |
| `<For>` | `map` | `v-for` |

## é›†æˆå…¶ä»–åº“
å› ä¸º Mitosis å¹¶ä¸æ˜¯ä¸€ä¸ªå‰ç«¯æ¡†æ¶, è€Œæ˜¯ä¸€ä¸ªç¼–è¯‘å™¨, æ‰€ä»¥å®ƒæ²¡æœ‰ webpack æˆ–è€… vite é›†æˆ.  
æ¯”å¦‚, æƒ³è¦ä½¿ç”¨ UnoCSS, åªèƒ½ä½¿ç”¨`uno cli`, ç›‘å¬æ–‡ä»¶å˜åŒ–ç„¶åç¼–è¯‘å‡º css æ–‡ä»¶, å†è¿›è¡Œå¼•å…¥.    

å½“ç„¶è¿˜æœ‰ä¸ªæ›´å¥½çš„åŠæ³•, æœ¬è´¨ä¸Š Mitosis åªæ˜¯ä¸€ä¸ªè½¬åŒ–ç®¡é“, é‚£æˆ‘ä»¬åªè¦è®¾ç½®`äº§ç‰©çš„ç¯å¢ƒ`å°±è¡Œäº†, Mitosis å®Œæˆè½¬æ¢åï¼Œç”±å…¶ä»–å·¥å…·æ¥ç®¡, è¿›è¡Œæ‰“åŒ….  
æœ€ç»ˆæˆ‘ä»¬ç¼–å†™ç»„ä»¶çš„æµç¨‹å°±å˜æˆäº†:  
1. ç¼–å†™ Mitosis ç»„ä»¶
2. ä½¿ç”¨`npm run build`ç¼–è¯‘, è¾“å‡ºåˆ° vite ç¯å¢ƒä¸­
3. ä½¿ç”¨`vite`ä¹‹ç±»çš„çš„æ‰“åŒ…å™¨å»æ‰“åŒ…æœ€ç»ˆçš„äº§ç‰©, npm å‘å¸ƒ

ä½ å¯ä»¥ä»¥è¿™ä¸ªé¡¹ç›®ä¸ºç¤ºä¾‹[unocss-icon-viewer](https://github.com/Ray-D-Song/unocss-icon-viewer).  

æœ‰ä¸€äº›å…³é”®ç‚¹ä½ å¯èƒ½éœ€è¦æ³¨æ„, æ¯”å¦‚mitosisçš„ tsconfig å°† jsxImportSource è®¾ç½®ä¸º`@builder.io/mitosis`.  
è¿™ä¼šå¯¼è‡´ä½  build react æˆ–è€… solid ä¹‹ç±»çš„åº“æ—¶, jsx ç±»å‹æŠ¥é”™.  
è§£å†³æ–¹æ¡ˆæ˜¯åœ¨ Vite ä¸­é…ç½® esbuild å’Œ ets æ’ä»¶, åŠ¨æ€ä¿®æ”¹ compilerOptions.  
```ts
export default defineConfig({
  plugins: [
    // ...
    dts({
      outDir: 'dist',
      include: 'packages/*/src/**',
      compilerOptions: {
        jsxImportSource: 'react',
      }
    }),
  ],
  // ...
  esbuild: {
    tsconfigRaw: {
      compilerOptions: {
        jsxImportSource: 'react',
      }
    }
  }
})
```

## ç¼ºé™·
Mitosis ç®—æ˜¯ä¸é”™çš„è§£å†³æ–¹æ¡ˆ, ä½†ä¹Ÿæœ‰ç¼ºé™·, æ¯”å¦‚:
* æ— æ³•æ§åˆ¶äº§ç‰©è´¨é‡, ç”Ÿæˆçš„ä»£ç å¹¶ä¸æ˜¯æœ€ä¼˜è§£  
* å¥‡å¥‡æ€ªæ€ªçš„è§„å®š, æ¯”å¦‚ props ä¸å¯ä»¥è§£æ„, åªèƒ½ç”¨`props.xxx`, æ¢è¨€ä¹‹å°±æ˜¯ç¼–è¯‘å™¨å¤ªå¼±äº†  
* ç¼–å†™æºç  => ç¼–è¯‘åˆ°æ‰“åŒ…å™¨ç¯å¢ƒ => è¿è¡Œæµ‹è¯•ç¯å¢ƒ, è¿™é‡Œé¢è‡³å°‘æ¶‰åŠ 3 ä¸ª watch å’Œç¯å¢ƒ, å¤ªè¿‡å¤æ‚  